<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Main Project</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.png" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../css/styles.css" rel="stylesheet" />
</head>
<body id="page-top">
<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container px-4 px-lg-5">
        <a class="navbar-brand" href="../index.html">Go back</a>
        <a class="nav-item" href="https://www.linkedin.com/in/balazsmolnar-devops/"><i class="fab fa-linkedin-in mx-2" ></i></a>
        <a class="nav-item" href="https://github.com/balazsmolnar87"><i class="fab fa-github mx-2" ></i></a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="#page-top">Go top</a></li>
                <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
                <li class="nav-item"><a class="nav-link" href="#pt1">Part 1</a></li>
                <li class="nav-item"><a class="nav-link" href="#pt2">Part 2</a></li>
                <li class="nav-item"><a class="nav-link" href="#pt3">Part 3</a></li>
                <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- Masthead-->
<header class="masthead main-project">
    <div class="container px-4 px-lg-5 d-flex h-100 align-items-center justify-content-center">
        <div class="d-flex justify-content-center">
            <div class="text-center">
                <h1 class="mx-auto my-0 text-uppercase">From zero<br>to hero</h1>
                <a class="btn btn-light" href="#about">Get Started</a>
            </div>
        </div>
    </div>
</header>
<!-- About-->
<section class="about-section text-center" id="about">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-8">
                <h2 class="text-white mb-4">This will be my journey where I deploy an app to the cloud.</h2>
                <p class="text-white-50">
                    Going step by step from the creation of a dummy application to extending it with features.
                    Applying different tools such as Docker, Docker Compose, Helm, Terraform, Kubernetes. We will
                    see...<br><br>Ever current code available at the following GitHub repository:<br>
                    <a href="https://github.com/balazsmolnar87/main-project">https://github.com/balazsmolnar87/main-project</a>
                </p>
            </div>
        </div>
    </div>
</section>
<!-- Disclaimer-->
<section class="bg-light" id="disclaimer">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-left">
            <div class="col-lg-8">
                <br>
                <h1>Disclaimer</h1>
                <p>As of now these are just my notes. This is not a guide. I am making it public so the visitor may have a look at my
                    progress on my pet project.</p>
            </div>
        </div>
    </div>
</section>
<!-- Part 1-->
<section class="bg-light" id="pt1">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-left">
            <div class="col-lg-8">
                <h1>Part 1</h1>
                <h2>Let's create a dummy python app with flask / Build Docker image / push image to Docker Hub</h2>
                <p>It will provide us an endpoint to return a text saying: "Hello from flask!".</p>
                <h3>Create an environment</h3>
                <p>python3 -m venv venv</p>
                <p>I'm on Windows so</p>
                <p>venv\Scripts\activate</p>
                <h3>Install Flask</h3>
                <p>pip install Flask</p>
                <p>pip freeze > requirements.txt</p>
                <h3>Let's run the flask server locally</h3>
                <p>flask --app app run</p>
                <p>It is running. Ctrl + left-click on the ip address or visit http://127.0.0.1:5000 in the browser</p>
                <p>It says: Hello from flask! Perfect!</p>
                <p>Since I have Docker installed let's make a Docker image out of this quick.</p>
                <h3>Add a Dockerfile</h3>
                <p>In the Dockerfile I have:</p>
                <p>FROM python:3.8-slim<br>WORKDIR /python-docker<br>COPY . .<br>RUN pip3 install -r requirements.txt<br>
                    CMD [ "python3", "-m" , "flask", "run", "--host=0.0.0.0"]</p>
                <h3>Build a Docker image</h3>
                <p>docker build . -t utamaro/flaskapp:0.1</p>
                <h3>Tag the image and push it to Docker Hub</h3>
                <p>Let's find out the image id</p>
                <p>docker images</p>
                <p>Tag the image</p>
                <p>docker tag f0ce34ca1b60 utamaro/flaskapp:0.1</p>
                <p>docker push utamaro/flaskapp:0.1</p>
                <p>Since I have Docker Desktop installed I could also click the image and select "Push to Hub"</p>
            </div>
        </div>
    </div>
</section>
<!-- Part 2-->
<section class="bg-light" id="pt2">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-left">
            <div class="col-lg-8">
                <h1>Part 2</h1>
                <h2>Let's add a WSGI server to run our application and a dedicated HTTP server / Add docker-compose</h2>
                <p>A move towards production.</p>
                <h3>I will use gunicorn as my WSGI</h3>
                <p>Open requirements.txt and append the list with the latest version of gunicorn</p>
                <p>gunicorn==20.1.0</p>
                <p>In the flask application's Dockerfile replace the entrypoint for a gunicorn command</p>
                <p>#CMD [ "python3", "-m" , "flask", "run", "--host=0.0.0.0"]</p>
                <p>CMD gunicorn -w 4 -b 0.0.0.0 'app:app'</p>
                <p>-w 4 means we will use four workers to handle the incoming requests. I bind to all external IPs on a
                    non-privileged port using the -b 0.0.0.0 option. </p>
                <h3>Let's add nginx as a reverse proxy</h3>
                <p>Inside my flaskapp folder I create a folder called web, and I move all contents of the flask
                    application to that folder. Inside flaskapp I create another folder called proxy for nginx. Inside
                    proxy I create two files. A Dockerfile and a conf.</p>
                <p>In Dockerfile I have</p>
                <p>FROM nginx:1.19.2-alpine<br>COPY conf /etc/nginx/conf.d/default.conf</p>
                <p>in conf</p>
                <p>server { listen 80; server_name localhost; location / { proxy_pass http://web:8000; }}</p>
                <p>Nginx will face the internet and listen on port 80 and will use proxy_pass to forward all
                    traffic to web:8000. Where web is the name of a service defined in the docker-compose file which I
                    will create next. Port 8000 is where gunicorn is listening.</p>
                <h3>Create a docker-compose file to run our containers</h3>
                <p>In the main directory I create a file called docker-compose.yml</p>
                <p>Inside I define two services (web and proxy) and a network (flask_network).</p>
                <p>In the terminal run</p>
                <p>docker-compose up</p>
                <p>Docker builds and runs our images and puts the containers in the same network for us. In the browser
                I visit localhost. Since the default port for HTTP is 80, my request first reaches nginx which forwards
                    it to gunicorn which serves my flask application. At last the response is visible for the main route
                Hello from flask!</p>
            </div>
        </div>
    </div>
</section>
<!-- Part 3-->
<section class="bg-light" id="pt3">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-left">
            <div class="col-lg-8">
                <h1>Part 3</h1>
                <h2></h2>
                <p>A move towards production.</p>
                <h3>I will use gunicorn as my WSGI</h3>
                <p>Open requirements.txt and append the list with the latest version of gunicorn</p>
                <p>gunicorn==20.1.0</p>
                <p>In the flask application's Dockerfile replace the entrypoint for a gunicorn command</p>
                <p>#CMD [ "python3", "-m" , "flask", "run", "--host=0.0.0.0"]</p>
                <p>CMD gunicorn -w 4 -b 0.0.0.0 'app:app'</p>
                <p>-w 4 means we will use four workers to handle the incoming requests. I bind to all external IPs on a
                    non-privileged port using the -b 0.0.0.0 option. </p>
                <h3>Let's add nginx as a reverse proxy</h3>
                <p>Inside my flaskapp folder I create a folder called web, and I move all contents of the flask
                    application to that folder. Inside flaskapp I create another folder called proxy for nginx. Inside
                    proxy I create two files. A Dockerfile and a conf.</p>
                <p>In Dockerfile I have</p>
                <p>FROM nginx:1.19.2-alpine<br>COPY conf /etc/nginx/conf.d/default.conf</p>
                <p>in conf</p>
                <p>server { listen 80; server_name localhost; location / { proxy_pass http://web:8000; }}</p>
                <p>Nginx will face the internet and listen on port 80 and will use proxy_pass to forward all
                    traffic to web:8000. Where web is the name of a service defined in the docker-compose file which I
                    will create next. Port 8000 is where gunicorn is listening.</p>
                <h3>Create a docker-compose file to run our containers</h3>
                <p>In the main directory I create a file called docker-compose.yml</p>
                <p>Inside I define two services (web and proxy) and a network (flask_network).</p>
                <p>In the terminal run</p>
                <p>docker-compose up</p>
                <p>Docker builds and runs our images and puts the containers in the same network for us. In the browser
                I visit localhost. Since the default port for HTTP is 80, my request first reaches nginx which forwards
                    it to gunicorn which serves my flask application. At last the response is visible for the main route
                Hello from flask!</p>
            </div>
        </div>
    </div>
</section>
<!-- Contact-->
<section class="contact-section bg-black" id="contact">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-md-4 mb-3 mb-md-0">
                <div class="card py-4 h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-envelope text-primary mb-2"></i>
                        <h4 class="text-uppercase m-0">Email</h4>
                        <hr class="my-4 mx-auto" />
                        <div class="small text-black-50"><a href="mailto:balazs.millair@gmail.com">balazs.millair@gmail.com</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="social d-flex justify-content-center">
            <a class="mx-2" href="https://www.linkedin.com/in/balazsmolnar-devops/"><i class="fab fa-linkedin-in"></i></a>
            <a class="mx-2" href="https://github.com/balazsmolnar87"><i class="fab fa-github"></i></a>
        </div>
    </div>
</section>
<!-- Footer-->
<footer class="footer bg-black small text-center text-white-50"><div class="container px-4 px-lg-5">Copyright &copy; Balazs Molnar 2022</div></footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="../js/scripts.js"></script>
</body>
</html>